<apex:page title="{!$Label.Title_Label}" controller="ImportDataFromCSVCtrl" lightningStyleSheets="true">

<apex:sectionHeader title="{!$Label.Title_Label}" subtitle="{!$Label.Step_2_of_2_Label}"/>
<apex:form >
    <apex:pageMessages />
    <apex:pageBlock title="{!$Label.Load_Records_Label}">
        <apex:pageBlockButtons location="top">
            <apex:commandButton value="{!$Label.Back}" action="{!step1}"/>
            <apex:commandButton value="{!$Label.Download_CSV_Template_Button_Label}" action="{!downloadCSVTemplate}"/>
            <apex:commandButton value="{!$Label.Clear_File_Label}" action="{!clearFile}"/>
            <apex:commandButton rendered="{!sObjectRecords.size > 0}" value="{!$Label.Insert_Records_Button_Label}" action="{!insertSObjectRecords}"/>
        </apex:pageBlockButtons>
        <apex:pageBlockSection title="{!$Label.Choose_File_To_Load_Label}" columns="1">
            <apex:inputFile value="{!CSVFileBody}" accept="csv"/>
            <apex:commandButton value="{!$Label.Load_Records_Label}" action="{!transformCSVFileBodyToRecords}"/>
        </apex:pageBlockSection>
        <apex:pageBlockSection title="{!$Label.Configurations_Label}">
            <apex:inputCheckbox value="{!allowPartialSuccess}" label="{!$Label.Allow_Partial_Success_Label}"/>
            <apex:selectList value="{!dateInputFormat}" size="1">
                <apex:selectOptions value="{!dateInputFormatOptions}"/>
            </apex:selectList>
        </apex:pageBlockSection>
        <apex:pageBlockSection title="{!$Label.Records_Table_Title_Label}" columns="1" collapsible="false">
            <apex:pageBlockTable value="{!sObjectRecords}" var="sor">
                <apex:inlineEditSupport event="onclick" />
                <apex:repeat value="{!fieldSetSObjectFields}" var="field">
                    <apex:column headerValue="{!field.label}">
                        <apex:outputField value="{!sor.record[field.developerName]}"/>
                    </apex:column>
                </apex:repeat>
                <apex:column >
                    <apex:repeat value="{!sor.errorMessages}" var="message">
                        <apex:outputText value="{!message}"/>
                    </apex:repeat>
                </apex:column>
            </apex:pageBlockTable>
        </apex:pageBlockSection>
    </apex:pageBlock>
</apex:form>
</apex:page>